<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>3D Model Viewer</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
    </style>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
</head>

<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        const canvas = document.getElementById('renderCanvas');
        const engine = new BABYLON.Engine(canvas, true);
        let scene;

        const createScene = () => {
            scene = new BABYLON.Scene(engine);
            const camera = new BABYLON.ArcRotateCamera("camera", Math.PI / 2, Math.PI / 2, 6, new BABYLON.Vector3(1, 1, 1), scene);
            camera.attachControl(canvas, true);

            // Set camera limits

            camera.lowerBetaLimit = 0.04; // Minimum angle
            camera.upperBetaLimit = Math.PI / 2; // Maximum angle
            camera.lowerRadiusLimit = 0; // Minimum zoom
            camera.upperRadiusLimit = 5; // Maximum zoom

            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0), scene);

            // Load the model
            BABYLON.SceneLoader.Append("news/", "scene.gltf", scene, () => {
                // Model loaded
                addHotspots(scene);
            });

            return scene;
        };

        const addHotspots = (scene) => {
            const hotspots = [
                {
                    position: new BABYLON.Vector3(0.34201399866747817, 0.6749948571414213, 0.6403644416782663),
                    name: "Anchor",
                    description: "About Anchors.",
                    imageUrl: "images/anchorPng.webp"
                },
                {
                    position: new BABYLON.Vector3(2.8953806705591094, 0.03309833904851556, -3.524757185839503),
                    name: "Pin1",
                    description: "Pin Place 1.",
                    imageUrl: "images/location.png"
                },
                {
                    position: new BABYLON.Vector3(-3.1100778840515897, 0.033098095750376366, -2.0314037630498887),
                    name: "Pin2",
                    description: "Pin Place 2",
                    imageUrl: "images/location.png"
                },
                {
                    position: new BABYLON.Vector3(4.280196886241561, 1.8737314278329338, -4.367287166169788),
                    name: "News1",
                    description: "News 1",
                    imageUrl: "images/whitePin.png"
                },
                {
                    position: new BABYLON.Vector3(-3.118104263952617, 1.9158559140710505, -4.6773845024277225),
                    name: "News1",
                    description: "News 2",
                    imageUrl: "images/whitePin.png"
                },
                {
                    position: new BABYLON.Vector3(5.83582994838639, 1.1744597207412382, -2.1605472800897623),
                    name: "Screen1",
                    description: "Screen 2",
                    imageUrl: "images/whitePin.png"
                },
                {
                    position: new BABYLON.Vector3(-5.830092642422417, 1.5486601343971076, -2.3214210385501963),
                    name: "miniScreen1",
                    description: "Mini Screen 1",
                    imageUrl: "images/whitePin.png"
                },
                {
                    position: new BABYLON.Vector3(-5.830092642422412, 1.464289292371488, -0.35597844516555344),
                    name: "miniScreen2",
                    description: "Mini Screen 2",
                    imageUrl: "images/whitePin.png"
                },
                {
                    position: new BABYLON.Vector3(-5.8300926424224135, 1.506974658303762, 1.5357887175789793),
                    name: "miniScreen3",
                    description: "Mini Screen 3",
                    imageUrl: "images/whitePin.png"
                },
            ];

            hotspots.forEach(hotspot => {
                createHotspot(scene, hotspot);
            });
        };

        const createHotspot = (scene, hotspot) => {
            const plane = BABYLON.MeshBuilder.CreatePlane("plane", { size: 0.3 }, scene);
            plane.position = hotspot.position;
            plane.billboardMode = BABYLON.Mesh.BILLBOARDMODE_ALL;

            const advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(plane);
            const button = BABYLON.GUI.Button.CreateImageOnlyButton("but", hotspot.imageUrl);
            advancedTexture.addControl(button);
            plane.renderingGroupId = 1;

            plane.actionManager = new BABYLON.ActionManager(scene);
            plane.actionManager.registerAction(new BABYLON.ExecuteCodeAction(
                BABYLON.ActionManager.OnPickTrigger,
                () => {
                    // console.log('Hotspot Name:', hotspot.name);
                    // alert(`Hotspot clicked: ${hotspot.name}\nDescription: ${hotspot.description}`);
                    window.parent.postMessage({ hotspotName: hotspot.name }, '*');
                }
            ));
        };

        createScene();
        engine.runRenderLoop(() => {
            scene.render();
        });

        window.addEventListener('resize', () => {
            engine.resize();
        });
    </script>
</body>

</html>